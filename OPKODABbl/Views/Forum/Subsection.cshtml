@model OPKODABbl.Models.Forum.Subsection

<div class="forum_navigation">
    <a asp-action="Index" asp-controller="Forum">Все разделы</a>
    <font color="white">»</font>
    <a asp-action="Subsection" asp-controller="Forum" asp-route-subsectionId="@Model.Id">@Model.SubsectionName</a>
</div>

@Html.ActionLink("Создать тему", "CreateTopic", "Forum", new { subsectionId = ViewBag.SubsectionId })

<br />

<table class="viewsubsection">
    <tr>
        <td class="header" style="width: 440px;">
            Topic Name
        </td>
        <td class="header" style="width: 150px;">
            Author
        </td>
        <td class="header" style="width: 80px;">
            Views
        </td>
        <td class="header" style="width: 80px;">
            Replies
        </td>
        <td class="header" style="width: 150px;">
            Last Message
        </td>
    </tr>
        @foreach (var topic in Model.Topics)
        {
            <tr>
                <td class="content">
                    <a asp-action="ViewTopic" asp-controller="Forum" asp-route-topicId="@topic.Id">@topic.TopicName</a>
                </td>
                <td class="content" style="text-align: center;">
                    @if (topic.Replies.Count > 0)
                    {
                        var firstReplyUser = @topic.Replies.OrderBy(r => r.ReplyDate).First().User;
                        <font color="@firstReplyUser.CharacterClass.ClassColor">@firstReplyUser.Name</font>
                    }
                </td>
                <td class="content" style="text-align: center;">
                    54
                </td>
                <td class="content" style="text-align: center;">
                    @{ 
                        var repliesCount = topic.Replies.Count() - 1;
                    }
                    @repliesCount
                </td>
                <td class="content_lastmessage" style="text-align: center;">
                    @if (topic.Replies.Count() > 1)
                    {
                        var classColor = topic.Replies.OrderByDescending(r => r.ReplyDate).First().User.CharacterClass.ClassColor;
                        var userName = topic.Replies.OrderByDescending(r => r.ReplyDate).First().User.Name;
                        var replyDate = topic.Replies.OrderByDescending(r => r.ReplyDate).First().ReplyDate;

                        <font color="@classColor">@userName</font>
                        <br />
                        @replyDate.ToShortDateString()
                    }
                    else
                    {
                        <font>-----</font>
                    }
                </td>
            </tr>
        }
</table>